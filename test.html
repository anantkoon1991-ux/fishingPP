<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DrMyland System Test</title>
    <style>
        body { font-family: 'Sarabun', Arial, sans-serif; background: #f5f7fa; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { background: white; border-radius: 12px; padding: 25px; margin: 20px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #1e3a8a; border-bottom: 3px solid #2563eb; padding-bottom: 10px; }
        h2 { color: #2563eb; margin-top: 0; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .test-card { background: #f8f9fa; border-left: 4px solid #2563eb; padding: 15px; border-radius: 6px; }
        .test-card h3 { margin-top: 0; color: #1e3a8a; }
        button { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin: 5px; font-size: 14px; }
        button:hover { background: #1d4ed8; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: #f59e0b; }
        .btn-warning:hover { background: #d97706; }
        .output { background: #0f172a; color: #10b981; padding: 12px; border-radius: 6px; font-family: 'Courier New', monospace; font-size: 12px; max-height: 300px; overflow-y: auto; margin: 10px 0; white-space: pre-wrap; word-break: break-all; }
        .status { display: inline-block; padding: 5px 10px; border-radius: 4px; font-size: 12px; font-weight: bold; margin: 5px 0; }
        .status.success { background: #d1fae5; color: #065f46; }
        .status.error { background: #fee2e2; color: #991b1b; }
        .status.info { background: #dbeafe; color: #0c4a6e; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ DrMyland System Test Dashboard</h1>
        
        <div class="section">
            <h2>üìä ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Backend Logic (Postman Simulation)</h2>
            <div class="grid">
                <div class="test-card">
                    <h3>1Ô∏è‚É£ Login Test</h3>
                    <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏≤ Token</p>
                    <button onclick="testLogin()">üîì ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô</button>
                    <div id="login-output" class="output"></div>
                </div>

                <div class="test-card">
                    <h3>2Ô∏è‚É£ Check Products</h3>
                    <p>‡πÄ‡∏ä‡πá‡∏Ñ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    <button onclick="testProducts()">üì¶ ‡∏î‡∏π‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                    <div id="products-output" class="output"></div>
                </div>

                <div class="test-card">
                    <h3>3Ô∏è‚É£ Create Bill</h3>
                    <p>‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                    <button onclick="testBill()" class="btn-success">üí≥ ‡∏¢‡∏¥‡∏á‡∏ö‡∏¥‡∏•</button>
                    <div id="bill-output" class="output"></div>
                </div>

                <div class="test-card">
                    <h3>4Ô∏è‚É£ Verify Stock</h3>
                    <p>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏¢</p>
                    <button onclick="testVerify()" class="btn-warning">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                    <div id="verify-output" class="output"></div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üñ•Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Frontend</h2>
            <div class="grid">
                <div class="test-card">
                    <h3>Service Request Test</h3>
                    <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</p>
                    <button onclick="window.open('http://localhost:3000/service.html', '_blank')" class="btn-success">üîî ‡πÄ‡∏õ‡∏¥‡∏î Service Page</button>
                </div>

                <div class="test-card">
                    <h3>Admin Dashboard Test</h3>
                    <p>‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ Admin (‡∏ï‡πâ‡∏≠‡∏á Bypass Login)</p>
                    <button onclick="testAdminBypass()" class="btn-warning">üîê Bypass Admin Login</button>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìà System Status</h2>
            <div id="status-container"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';
        let token = null;

        function log(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent += message + '\n';
                element.scrollTop = element.scrollHeight;
            }
        }

        function clearLog(elementId) {
            const element = document.getElementById(elementId);
            if (element) element.textContent = '';
        }

        async function testLogin() {
            clearLog('login-output');
            log('login-output', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô...\n');

            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username: 'admin', password: '123456' })
                });

                const result = await response.json();
                if (result.success) {
                    token = result.data.token;
                    log('login-output', '‚úÖ ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô PASS\n');
                    log('login-output', `üìã Username: ${result.data.user.username}\n`);
                    log('login-output', `üë§ Role: ${result.data.user.role}\n`);
                    log('login-output', `üîë Token: ${token.substring(0, 50)}...\n`);
                } else {
                    log('login-output', '‚ùå ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô FAIL: ' + result.error);
                }
            } catch (err) {
                log('login-output', '‚ùå ERROR: ' + err.message);
            }
        }

        async function testProducts() {
            clearLog('products-output');
            log('products-output', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...\n');

            try {
                const response = await fetch(`${API_URL}/api/products`);
                const result = await response.json();

                if (result.success) {
                    log('products-output', '‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• PASS\n');
                    log('products-output', `üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${result.data.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\n\n`);
                    
                    result.data.slice(0, 3).forEach(product => {
                        log('products-output', `ID: ${product.id}\n`);
                        log('products-output', `‡∏ä‡∏∑‡πà‡∏≠: ${product.name}\n`);
                        log('products-output', `‡∏™‡∏ï‡πá‡∏≠‡∏Å: ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô\n`);
                        log('products-output', `‡∏£‡∏≤‡∏Ñ‡∏≤: ${product.price}\n---\n`);
                    });
                } else {
                    log('products-output', '‚ùå ERROR: ' + result.error);
                }
            } catch (err) {
                log('products-output', '‚ùå ERROR: ' + err.message);
            }
        }

        async function testBill() {
            clearLog('bill-output');
            log('bill-output', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏•...\n');

            try {
                const billData = {
                    total: 100,
                    paymentMethod: 'cash',
                    items: [
                        { product_id: 1, quantity: 3, price: 30 }
                    ]
                };

                const response = await fetch(`${API_URL}/api/bills`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(billData)
                });

                const result = await response.json();
                if (result.success) {
                    log('bill-output', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏¥‡∏• PASS\n');
                    log('bill-output', `üí≥ Bill ID: ${result.data.bill_id}\n`);
                    log('bill-output', `üí∞ ‡∏¢‡∏≠‡∏î: 100 ‡∏ö‡∏≤‡∏ó\n`);
                    log('bill-output', `üì¶ ‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å: 3 ‡∏ä‡∏¥‡πâ‡∏ô\n`);
                    log('bill-output', `‚úÖ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß\n`);
                } else {
                    log('bill-output', '‚ùå ERROR: ' + result.error);
                }
            } catch (err) {
                log('bill-output', '‚ùå ERROR: ' + err.message);
            }
        }

        async function testVerify() {
            clearLog('verify-output');
            log('verify-output', '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å...\n');

            try {
                const response = await fetch(`${API_URL}/api/products`);
                const result = await response.json();

                if (result.success) {
                    const product = result.data.find(p => p.id === 1);
                    if (product) {
                        log('verify-output', '‚úÖ ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡∏î‡πÅ‡∏•‡πâ‡∏ß\n');
                        log('verify-output', `‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ${product.name}\n`);
                        log('verify-output', `‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô\n`);
                        log('verify-output', `(‡∏•‡∏î‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Bill ‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß)\n`);
                    }
                }
            } catch (err) {
                log('verify-output', '‚ùå ERROR: ' + err.message);
            }
        }

        function testAdminBypass() {
            const code = `
            localStorage.setItem('user', JSON.stringify({ username: 'admin', role: 'admin' }));
            window.open('http://localhost:3000/admin.html', '_blank');
            `;
            alert('‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ Admin ‡πÉ‡∏´‡∏°‡πà‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ Bypass Login\n' + code);
            localStorage.setItem('user', JSON.stringify({ username: 'admin', role: 'admin' }));
            window.open('http://localhost:3000/admin.html', '_blank');
        }

        // Update status on load
        async function updateStatus() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const result = await response.json();
                const statusHtml = `
                    <div class="status success">‚úÖ Server Running</div>
                    <div class="status info">Port: 3000</div>
                    <div class="status info">Environment: ${result.env}</div>
                `;
                document.getElementById('status-container').innerHTML = statusHtml;
            } catch (err) {
                document.getElementById('status-container').innerHTML = '<div class="status error">‚ùå Server Not Responding</div>';
            }
        }

        updateStatus();
    </script>
</body>
</html>
