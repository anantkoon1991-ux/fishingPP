<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô - Dr.Myland</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Sarabun', sans-serif; background: #f8fafc; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Header & Nav */
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-back { text-decoration: none; color: #64748b; font-weight: bold; }
        .btn-add { background: #2563eb; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; border: none; background: #e2e8f0; border-radius: 20px; cursor: pointer; font-weight: bold; color: #64748b; }
        .tab-btn.active { background: #2563eb; color: white; }

        /* Table */
        .asset-card { background: white; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); padding: 20px; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f1f5f9; color: #475569; }
        .status-active { color: #16a34a; font-weight: bold; }
        .status-disposed { color: #dc2626; text-decoration: line-through; }

        /* Modal (Form) */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; }
        .modal-content { background: white; padding: 25px; border-radius: 10px; width: 400px; }
        input, select { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .action-btn { cursor: pointer; margin-right: 5px; padding: 5px 10px; border-radius: 4px; border: 1px solid #ddd; }
        .btn-repair { background: #fef08a; color: #854d0e; }
        .btn-dispose { background: #fecaca; color: #991b1b; }
    </style>
    <script src="config.js"></script>
</head>
<body>

<div class="container">
    <div class="header">
        <div>
            <a href="manager.html" class="btn-back"><i class="fas fa-arrow-left"></i> ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ</a>
            <h1>üèõÔ∏è ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô</h1>
        </div>
        <button class="btn-add" onclick="openModal('add')">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà</button>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="filterCat('outdoor')">üå≥ ‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á</button>
        <button class="tab-btn" onclick="filterCat('electrical')">üí° ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</button>
        <button class="tab-btn" onclick="filterCat('building')">üè† ‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á</button>
        <button class="tab-btn" onclick="filterCat('garden')">üåª ‡∏™‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á</button>
    </div>

    <div class="asset-card">
        <table>
            <thead>
                <tr>
                    <th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                    <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤/‡∏´‡∏ô‡πà‡∏ß‡∏¢</th>
                    <th>‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°</th>
                    <th>‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏°‡∏∑‡πà‡∏≠</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="assetTable">
                <tr><td colspan="7">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
            </tbody>
        </table>
    </div>
</div>

<div id="addModal" class="modal">
    <div class="modal-content">
        <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
        <input type="text" id="newName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏ï‡πä‡∏∞)">
        <select id="newCat">
            <option value="outdoor">‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏à‡πâ‡∏á</option>
            <option value="electrical">‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤</option>
            <option value="building">‡∏™‡∏¥‡πà‡∏á‡∏õ‡∏•‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á</option>
            <option value="garden">‡∏™‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á</option>
        </select>
        <div style="display:flex; gap:10px;">
            <input type="number" id="newQty" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" value="1">
            <input type="text" id="newUnit" placeholder="‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ï‡∏±‡∏ß/‡∏ä‡∏∏‡∏î)" value="‡∏ï‡∏±‡∏ß">
        </div>
        <input type="number" id="newPrice" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢">
        <input type="date" id="newDate">
        <button onclick="saveAsset()" style="width:100%; background:#2563eb; color:white; border:none; padding:10px; border-radius:5px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button onclick="closeModal('add')" style="width:100%; margin-top:10px; background:transparent; border:none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<div id="actionModal" class="modal">
    <div class="modal-content">
        <h3 id="actionTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</h3>
        <input type="hidden" id="actAssetId">
        <select id="actType">
            <option value="repair">üõ†Ô∏è ‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</option>
            <option value="dispose">üóëÔ∏è ‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å (‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢/‡∏Ç‡∏≤‡∏¢‡∏ó‡∏¥‡πâ‡∏á)</option>
        </select>
        <input type="number" id="actCost" placeholder="‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
        <input type="text" id="actDesc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡∏≤‡πÇ‡∏ï‡πä‡∏∞)">
        <button onclick="saveAction()" style="width:100%; background:#ef4444; color:white; border:none; padding:10px; border-radius:5px;">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•</button>
        <button onclick="closeModal('action')" style="width:100%; margin-top:10px; background:transparent; border:none;">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
</div>

<script>
    let allAssets = [];
    let currentCat = 'outdoor';

    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    async function loadAssets() {
        const res = await AppConfig.fetch('/api/assets');
        allAssets = await res.json();
        renderTable();
    }

    function renderTable() {
        const tbody = document.getElementById('assetTable');
        tbody.innerHTML = '';
        
        // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà
        const filtered = allAssets.filter(a => a.category === currentCat);

        if(filtered.length === 0) {
            tbody.innerHTML = '<tr><td colspan="7" style="text-align:center; padding:20px;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏°‡∏ß‡∏î‡∏ô‡∏µ‡πâ</td></tr>';
            return;
        }

        filtered.forEach(a => {
            const date = new Date(a.buy_date).toLocaleDateString('th-TH');
            const total = (a.quantity * a.price_per_unit).toLocaleString();
            const statusClass = a.status === 'active' ? 'status-active' : 'status-disposed';
            const statusText = a.status === 'active' ? '‡∏õ‡∏Å‡∏ï‡∏¥' : '‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß';

            // ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ (‡∏ñ‡πâ‡∏≤‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏õ‡∏∏‡πà‡∏°)
            const actions = a.status === 'active' ? `
                <button class="action-btn btn-repair" onclick="openAction(${a.id}, '‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°')">‡∏ã‡πà‡∏≠‡∏°</button>
                <button class="action-btn btn-dispose" onclick="openAction(${a.id}, '‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢')">‡∏à‡∏≥‡∏´‡∏ô‡πà‡∏≤‡∏¢</button>
            ` : '-';

            tbody.innerHTML += `
                <tr>
                    <td>${a.name}</td>
                    <td>${a.quantity} ${a.unit}</td>
                    <td>${Number(a.price_per_unit).toLocaleString()}</td>
                    <td>${total}</td>
                    <td>${date}</td>
                    <td class="${statusClass}">${statusText}</td>
                    <td>${actions}</td>
                </tr>
            `;
        });
    }

    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Tab
    function filterCat(cat) {
        currentCat = cat;
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        renderTable();
    }

    // Modal Functions
    function openModal(type) { document.getElementById(type+'Modal').style.display = 'flex'; }
    function closeModal(type) { document.getElementById(type+'Modal').style.display = 'none'; }
    
    document.getElementById('newDate').valueAsDate = new Date();

    async function saveAsset() {
        const body = {
            name: document.getElementById('newName').value,
            category: document.getElementById('newCat').value,
            quantity: document.getElementById('newQty').value,
            unit: document.getElementById('newUnit').value,
            price: document.getElementById('newPrice').value,
            date: document.getElementById('newDate').value
        };
        await AppConfig.fetch('/api/assets', {
            method: 'POST',
            body: JSON.stringify(body)
        });
        closeModal('add');
        loadAssets();
    }

    function openAction(id, name) {
        document.getElementById('actAssetId').value = id;
        document.getElementById('actionTitle').innerText = '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£: ' + name;
        openModal('action');
    }

    async function saveAction() {
        const body = {
            asset_id: document.getElementById('actAssetId').value,
            action: document.getElementById('actType').value,
            cost: document.getElementById('actCost').value || 0,
            desc: document.getElementById('actDesc').value
        };
        await AppConfig.fetch('/api/assets/action', {
            method: 'POST',
            body: JSON.stringify(body)
        });
        closeModal('action');
        loadAssets();
        alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
    }

    loadAssets();
</script>
</body>
</html>
