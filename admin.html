<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr.Myland Management Suite</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Sarabun', sans-serif; margin: 0; display: flex; height: 100vh; background: #f8fafc; overflow: hidden; }
        
        .sidebar { width: 260px; background: #ffffff; color: #334155; display: flex; flex-direction: column; border-right: 1px solid #e2e8f0; box-shadow: 4px 0 24px rgba(0,0,0,0.02); }
        .logo { padding: 30px 20px; font-size: 1.6em; font-weight: 800; color: #1e3a8a; display: flex; align-items: center; gap: 10px; }
        .logo i { color: #10b981; }

        .menu { flex: 1; padding: 10px; display: flex; flex-direction: column; gap: 5px; }
        .menu-item { padding: 12px 20px; cursor: pointer; display: flex; align-items: center; color: #64748b; border-radius: 12px; font-weight: 500; transition: 0.2s; }
        .menu-item:hover { background: #f1f5f9; color: #1e3a8a; }
        .menu-item.active { background: linear-gradient(90deg, #2563eb, #1d4ed8); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25); }
        .menu-item i { margin-right: 15px; width: 24px; text-align: center; }
        
        /* Class สำหรับซ่อนเมนูตามสิทธิ์ */
        .restricted { display: none !important; }

        .user-info { padding: 20px; border-top: 1px solid #f1f5f9; background: #f8fafc; }
        .user-profile { font-weight: bold; color: #333; display: block; margin-bottom: 5px; }
        .user-role { font-size: 0.8em; color: #64748b; margin-bottom: 10px; }
        .logout { color: #ef4444; cursor: pointer; font-size: 0.9em; display: inline-flex; align-items: center; gap: 5px; margin-top: 5px; }

        .content { flex: 1; position: relative; background: #f1f5f9; }
        .section { display: none; width: 100%; height: 100%; }
        .section.active { display: block; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
    <script src="config.js"></script>
</head>
<body>

    <div class="sidebar">
        <div class="logo"><i class="fas fa-fish"></i> Dr.Myland</div>
        
        <div class="menu">
            <div class="menu-item active" onclick="switchTab('pos', this)">
                <i class="fas fa-cash-register"></i> หน้าร้าน (POS)
            </div>
            
            <div class="menu-item" onclick="switchTab('finance', this)">
                <i class="fas fa-file-invoice-dollar"></i> บัญชี & รายงาน
            </div>

            <div class="menu-item restricted manager-only" onclick="switchTab('manager', this)">
                <i class="fas fa-user-tie"></i> ผู้จัดการ (Manager)
            </div>
            <div class="menu-item restricted manager-only" onclick="switchTab('assets', this)">
                <i class="fas fa-warehouse"></i> คลังทรัพย์สิน
            </div>
            <div class="menu-item restricted manager-only" onclick="switchTab('live', this)">
                <i class="fas fa-desktop"></i> จอภาพ (Live)
            </div>
        </div>

        <div class="user-info">
            <span class="user-profile" id="showUser">Guest</span><br>
            <span class="user-role" id="showRole">-</span>
            <div class="logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> ออกจากระบบ</div>
        </div>
    </div>

    <div class="content">
        <div id="sec-pos" class="section active"><iframe src="pos.html"></iframe></div>
        <div id="sec-finance" class="section"><iframe src="finance.html"></iframe></div>
        <div id="sec-manager" class="section"><iframe src="manager.html"></iframe></div>
        <div id="sec-assets" class="section"><iframe src="assets.html"></iframe></div>
        <div id="sec-live" class="section"><iframe src="dashboard.html"></iframe></div>
    </div>

    <script>
        // ตรวจสอบ Login
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) { window.location.href = 'login.html'; } 
        else {
            document.getElementById('showUser').innerText = user.username;
            document.getElementById('showRole').innerText = user.role.toUpperCase();

            // --- Logic แบ่งสิทธิ์ ---
            if (user.role === 'admin' || user.role === 'manager') {
                // ถ้าเป็น Admin/Manager ให้แสดงเมนูที่ซ่อนอยู่ทั้งหมด
                document.querySelectorAll('.manager-only').forEach(el => el.classList.remove('restricted'));
            } 
            // ถ้าเป็น Staff จะไม่ทำอะไร (เมนู Manager ยังคงถูกซ่อนด้วย class restricted)
        }

        function switchTab(name, element) {
            document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active'));
            element.classList.add('active');
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('sec-' + name).classList.add('active');
        }

        function logout() {
            if(confirm('ยืนยันออกจากระบบ?')) {
                localStorage.removeItem('user');
                localStorage.removeItem('token');
                window.location.href = 'login.html';
            }
        }
    </script>
</body>
</html>
